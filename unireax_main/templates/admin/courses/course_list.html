{% extends 'base.html' %}
{% load static %}

{% block title_name %}Управление курсами{% endblock %}

{% block content %}
<section class="users-panel">
    <div class="users-container">
        <h1 class="users-title">Управление курсами</h1>
        <p class="users-subtitle">Список всех курсов</p>

        <div class="users-filters-section">
            <form method="get" class="users-filter-form">
                <div class="users-search-bar">
                    <input type="text" name="search" placeholder="Поиск курсов..." value="{{ search_query }}">
                </div>
                <select name="category_filter" class="users-select-filter">
                    <option value="">Все категории</option>
                    {% for category in categories %}
                        <option value="{{ category.id }}" {% if category_filter == category.id|stringformat:"i" %}selected{% endif %}>
                            {{ category.course_category_name }}
                        </option>
                    {% endfor %}
                </select>
                <select name="type_filter" class="users-select-filter">
                    <option value="">Все типы</option>
                    {% for type in types %}
                        <option value="{{ type.id }}" {% if type_filter == type.id|stringformat:"i" %}selected{% endif %}>
                            {{ type.course_type_name }}
                        </option>
                    {% endfor %}
                </select>
                <select name="active_filter" class="users-select-filter">
                    <option value="">Все статусы</option>
                    <option value="active" {% if active_filter == 'active' %}selected{% endif %}>Активные</option>
                    <option value="inactive" {% if active_filter == 'inactive' %}selected{% endif %}>Неактивные</option>
                </select>
                <button type="submit" class="users-filter-btn">Применить</button>
                <a href="{% url 'course_list' %}" class="users-reset-btn">Сбросить</a>
            </form>
        </div>

        <div class="users-table-container">
            <table class="users-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Название</th>
                        <th>Категория</th>
                        <th>Тип</th>
                        <th>Цена</th>
                        <th>Часы</th>
                        <th>Сертификат</th>
                        <th>Статус</th>
                        <th>Завершён</th>
                        <th>Создал</th>
                        <th>Действия</th>
                    </tr>
                </thead>
                <tbody>
                    {% for course in courses %}
                    <tr>
                        <td>{{ course.id }}</td>
                        <td>
                            <div class="course-name-cell">
                                {% if course.course_photo_path %}
                                <img src="{{ course.course_photo_path.url }}" alt="{{ course.course_name }}" 
                                     class="course-thumbnail">
                                {% endif %}
                                <span>{{ course.course_name }}</span>
                            </div>
                        </td>
                        <td>{{ course.course_category.course_category_name }}</td>
                        <td>{{ course.course_type.course_type_name }}</td>
                        <td>
                            {% if course.course_price %}
                                {{ course.course_price }} ₽
                            {% else %}
                                -
                            {% endif %}
                        </td>
                        <td>{{ course.course_hours }} ч</td>
                        <td>
                            {% if course.has_certificate %}
                                <span class="user-status-verified">✓ Да</span>
                            {% else %}
                                <span class="user-status-pending">Нет</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if course.is_active %}
                                <span class="user-status-active">✓ Активен</span>
                            {% else %}
                                <span class="user-status-inactive">✗ Неактивен</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if course.is_completed %}
                                <span class="user-status-completed">✓ Да</span>
                            {% else %}
                                <span class="user-status-pending"> Нет</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if course.created_by %}
                                {{ course.created_by.get_full_name|default:course.created_by.username }}
                            {% else %}
                                Администратор
                            {% endif %}
                        </td>                        
                        <td>
                        <div class="users-actions">
                                <a href="{% url 'course_detail' course.id %}" class="users-action-view">Просмотр</a>
                                <a href="{% url 'update_course' course.id %}" class="users-action-edit">Изменить</a>
                                <a href="{% url 'delete_course' course.id %}" class="users-action-delete">Удалить</a>
                            </div>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="11" class="users-no-data">Курсы не найдены.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <div class="users-add-section">
            <a href="{% url 'create_course' %}" class="users-add-btn">Добавить новый курс</a>
        </div>

        {% if courses.has_other_pages %}
        <div class="users-pagination">
            <span class="users-pagination-links">
                {% if courses.has_previous %}
                    <a href="?page=1{% if search_query %}&search={{ search_query }}{% endif %}{% if category_filter %}&category_filter={{ category_filter }}{% endif %}{% if type_filter %}&type_filter={{ type_filter }}{% endif %}{% if active_filter %}&active_filter={{ active_filter }}{% endif %}">&laquo; Первая</a>
                    <a href="?page={{ courses.previous_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if category_filter %}&category_filter={{ category_filter }}{% endif %}{% if type_filter %}&type_filter={{ type_filter }}{% endif %}{% if active_filter %}&active_filter={{ active_filter }}{% endif %}">Предыдущая</a>
                {% endif %}

                <span class="users-pagination-current">
                    Страница {{ courses.number }} из {{ courses.paginator.num_pages }}.
                </span>

                {% if courses.has_next %}
                    <a href="?page={{ courses.next_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if category_filter %}&category_filter={{ category_filter }}{% endif %}{% if type_filter %}&type_filter={{ type_filter }}{% endif %}{% if active_filter %}&active_filter={{ active_filter }}{% endif %}">Следующая</a>
                    <a href="?page={{ courses.paginator.num_pages }}{% if search_query %}&search={{ search_query }}{% endif %}{% if category_filter %}&category_filter={{ category_filter }}{% endif %}{% if type_filter %}&type_filter={{ type_filter }}{% endif %}{% if active_filter %}&active_filter={{ active_filter }}{% endif %}">Последняя &raquo;</a>
                {% endif %}
            </span>
        </div>
        {% endif %}
    </div>
</section>
{% endblock %}