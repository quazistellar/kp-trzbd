{% extends 'base.html' %}
{% load static %}

{% block title_name %}Управление ролями{% endblock %}

{% block link_style %}
    {{ block.super }}
{% endblock %}

{% block content %}
<section class="users-panel">
    <div class="users-container">
        <h1 class="users-title">Управление ролями</h1>
        <p class="users-subtitle">Список всех ролей пользователей</p>

        <div class="users-filters-section">
            <form method="get" class="users-filter-form">
                <div class="users-search-bar">
                    <input type="text" name="search" placeholder="Поиск ролей..." value="{{ search_query }}">
                </div>
                <button type="submit" class="users-filter-btn">Применить</button>
                <a href="{% url 'role_list' %}" class="users-reset-btn">Сбросить</a>
            </form>
        </div>

        <div class="users-table-container">
            <table class="users-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Название роли</th>
                        <th>Количество пользователей</th>
                        <th>Действия</th>
                    </tr>
                </thead>
                <tbody>
                    {% for role in roles %}
                    <tr>
                        <td>{{ role.id }}</td>
                        <td>{{ role.role_name }}</td>
                        <td>
                            {% with role.user_set.count as user_count %}
                            <span class="{% if user_count > 0 %}user-status-active{% else %}user-status-pending{% endif %}">
                                {{ user_count }} пользователь(ей)
                            </span>
                            {% endwith %}
                        </td>
                        <td>
                            <div class="users-actions">
                                <a href="{% url 'role_detail' role.id %}" class="users-action-view">Просмотр</a>
                                <a href="{% url 'create_update_role' role.id %}" class="users-action-edit">Изменить</a>
                                <a href="{% url 'delete_role' role.id %}" class="users-action-delete">Удалить</a>
                            </div>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="4" class="users-no-data">Роли не найдены.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <div class="users-add-section">
            <a href="{% url 'create_update_role' %}" class="users-add-btn">Добавить новую роль</a>
        </div>

        {% if roles.has_other_pages %}
        <div class="users-pagination">
            <span class="users-pagination-links">
                {% if roles.has_previous %}
                    <a href="?page=1{% if search_query %}&search={{ search_query }}{% endif %}">&laquo; Первая</a>
                    <a href="?page={{ roles.previous_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}">Предыдущая</a>
                {% endif %}

                <span class="users-pagination-current">
                    Страница {{ roles.number }} из {{ roles.paginator.num_pages }}.
                </span>

                {% if roles.has_next %}
                    <a href="?page={{ roles.next_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}">Следующая</a>
                    <a href="?page={{ roles.paginator.num_pages }}{% if search_query %}&search={{ search_query }}{% endif %}">Последняя &raquo;</a>
                {% endif %}
            </span>
        </div>
        {% endif %}
    </div>
</section>
{% endblock %}