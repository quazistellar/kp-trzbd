{% extends 'base.html' %}
{% load static %}

{% block title_name %}
–ë—ç–∫–∞–ø - UNIREAX
{% endblock %}

{% block link_style %}
{{ block.super }}

{% endblock %}

{% block content %}
<section class="backup-section">
    <div class="backup-container">
        <div class="backup-header">
            <h1 class="backup-title">–†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ</h1>
            <p class="backup-subtitle">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã–º–∏ –∫–æ–ø–∏—è–º–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º—ã UNIREAX</p>
        </div>

        <div class="backup-warning">
            <strong>‚ö†Ô∏è –í–ê–ñ–ù–û–ï –ü–†–ï–î–£–ü–†–ï–ñ–î–ï–ù–ò–ï</strong>
            –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–º–µ–Ω–∏—Ç –≤—Å–µ —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ –Ω–∞ –¥–∞–Ω–Ω—ã–µ –∏–∑ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –±—ç–∫–∞–ø–∞. 
            –≠—Ç–∞ –æ–ø–µ—Ä–∞—Ü–∏—è –Ω–µ–æ–±—Ä–∞—Ç–∏–º–∞ –∏ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –ø–æ—Ç–µ—Ä–µ –¥–∞–Ω–Ω—ã—Ö. –í—Å–µ–≥–¥–∞ —Å–æ–∑–¥–∞–≤–∞–π—Ç–µ –Ω–æ–≤—ã–π –±—ç–∫–∞–ø –ø–µ—Ä–µ–¥ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ–º!
        </div>

        <div class="backup-actions-grid">
            <div class="backup-action-card">
                <h3>–°–æ–∑–¥–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é</h3>
                <p>–°–æ–∑–¥–∞–π—Ç–µ –ø–æ–ª–Ω—É—é —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é –≤—Å–µ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö. –§–∞–π–ª –±—É–¥–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ —Ñ–æ—Ä–º–∞—Ç–µ SQL —Å –≤—Ä–µ–º–µ–Ω–Ω–æ–π –º–µ—Ç–∫–æ–π –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏.</p>
                <form action="{% url 'backup_database' %}" method="post" class="backup-form">
                    {% csrf_token %}
                    <input type="hidden" name="action" value="backup">
                    <button type="submit" class="backup-btn backup-btn-create">
                        –°–æ–∑–¥–∞—Ç—å –±—ç–∫–∞–ø
                    </button>
                </form>
            </div>

            <div class="backup-action-card restore">
                <h3>–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ –∫–æ–ø–∏–∏</h3>
                <p>–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Ä–∞–Ω–µ–µ —Å–æ–∑–¥–∞–Ω–Ω–æ–π —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏. –í—Å–µ —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –∑–∞–º–µ–Ω–µ–Ω—ã.</p>
                <div class="backup-form-group">
                    {% if backups %}
                    <form action="{% url 'backup_database' %}" method="post" class="backup-form">
                        {% csrf_token %}
                        <input type="hidden" name="action" value="restore">
                        <select name="backup_file" class="backup-select" required>
                            <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª –±—ç–∫–∞–ø–∞ --</option>
                            {% for backup in backups %}
                            <option value="{{ backup.name }}">
                                {{ backup.name }} ({{ backup.formatted_size }}) - {{ backup.formatted_time }}
                            </option>
                            {% endfor %}
                        </select>
                        <button type="submit" class="backup-btn backup-btn-restore" onclick="return confirmRestore()">
                            –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
                        </button>
                    </form>
                    {% else %}
                    <button class="backup-btn backup-btn-restore" disabled>
                        –ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –±—ç–∫–∞–ø–æ–≤
                    </button>
                    {% endif %}
                </div>
            </div>
        </div>

        <div class="backup-list">
            <h3>–î–æ—Å—Ç—É–ø–Ω—ã–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏</h3>
            
            {% if backups %}
                {% for backup in backups %}
                <div class="backup-item">
                    <div class="backup-info">
                        <div class="backup-name">{{ backup.name }}</div>
                        <div class="backup-details">
                            <span>{{ backup.formatted_size }}</span>
                            <span>{{ backup.formatted_time }}</span>
                            <span>{{ backup.path }}</span>
                        </div>
                    </div>
                    <div class="backup-actions">
                        <form action="{% url 'backup_database' %}" method="post" class="backup-form">
                            {% csrf_token %}
                            <input type="hidden" name="action" value="restore">
                            <input type="hidden" name="backup_file" value="{{ backup.name }}">
                            <button type="submit" class="backup-btn backup-btn-restore" onclick="return confirmRestore()">
                                –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
                            </button>
                        </form>
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <div class="backup-empty">
                    –†–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç<br>
                    <small>–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—É—é —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é –¥–ª—è –∑–∞—â–∏—Ç—ã –¥–∞–Ω–Ω—ã—Ö</small>
                </div>
            {% endif %}
        </div>
    </div>
</section>
{% endblock %}

{% block scripts %}
{{ block.super }}
<script>
function confirmRestore() {
    const confirmed = confirm(
        '‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï! –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ü–†–ï–î–£–ü–†–ï–ñ–î–ï–ù–ò–ï!\n\n' +
        '–í—ã —Å–æ–±–∏—Ä–∞–µ—Ç–µ—Å—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏.\n\n' +
        '‚ùå –í–°–ï –¢–ï–ö–£–©–ò–ï –î–ê–ù–ù–´–ï –ë–£–î–£–¢ –ü–û–õ–ù–û–°–¢–¨–Æ –£–î–ê–õ–ï–ù–´ –ò –ó–ê–ú–ï–ù–ï–ù–´!\n' +
        '‚ùå –≠–¢–û –î–ï–ô–°–¢–í–ò–ï –ù–ï–û–ë–†–ê–¢–ò–ú–û!\n' +
        '‚ùå –í–°–ï –ò–ó–ú–ï–ù–ï–ù–ò–Ø –ü–û–°–õ–ï –°–û–ó–î–ê–ù–ò–Ø –ë–≠–ö–ê–ü–ê –ë–£–î–£–¢ –£–¢–ï–†–Ø–ù–´!\n\n' +
        '–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å?'
    );
    
    if (!confirmed) {
        return false;
    }
    
    const doubleConfirmed = confirm(
        'üö® –ü–û–°–õ–ï–î–ù–ï–ï –ü–†–ï–î–£–ü–†–ï–ñ–î–ï–ù–ò–ï!\n\n' +
        '–≠—Ç–æ –ø—Ä–∏–≤–µ–¥–µ—Ç –∫ –ø–æ–ª–Ω–æ–π –∑–∞–º–µ–Ω–µ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö –≤ —Å–∏—Å—Ç–µ–º–µ.\n' +
        '–û—Ç–º–µ–Ω–∏—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –±—É–¥–µ—Ç –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ.\n\n' +
        '–í–≤–µ–¥–∏—Ç–µ OK –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è:'
    );
    
    return doubleConfirmed;
}

document.addEventListener('DOMContentLoaded', function() {
    console.log('Backup system loaded');
});
</script>
{% endblock %}