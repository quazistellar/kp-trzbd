{% extends '403.html' %} 
{% load static %}

{% block title_name %}
Ошибка безопасности - UNIREAX
{% endblock %}

{% block content %}
<section class="error-section">
    <div class="error-container">
        <div class="error-content">
            <div class="error-decoration">
                <div class="error-icon" style="background: linear-gradient(135deg, #007bff, #0056b3);"> {# Измененный градиент для иконки #}
                    <i class="fas fa-user-shield"></i> {# Иконка для ошибки безопасности #}
                </div>
            </div>

            <div class="error-main">
                <h1 class="error-code" style="color: #007bff;">403</h1> {# Измененный цвет кода ошибки #}
                <h2 class="error-title">Ошибка безопасности</h2>
                <p class="error-description">
                    Ваш запрос был отклонен из-за проблем с безопасностью. Скорее всего, это произошло из-за недействительного или отсутствующего CSRF-токена.
                </p>

                {# Информация о причине и возможных решениях #}
                <div class="access-info">
                    <div class="info-card">
                        <i class="fas fa-exclamation-triangle" style="color: #ffc107;"></i> {# Желтая иконка #}
                        <div class="info-content">
                            <h4>Возможные причины:</h4>
                            <ul>
                                <li>Вы долгое время не отправляли форму (сессия истекла).</li>
                                <li>Проблема с файлами cookie в вашем браузере.</li>
                                <li>Попытка несанкционированного доступа.</li>
                            </ul>
                        </div>
                    </div>
                    <div class="info-card" style="margin-top: 20px;">
                        <i class="fas fa-redo" style="color: #28a745;"></i> {# Зеленая иконка #}
                        <div class="info-content">
                            <h4>Что можно сделать:</h4>
                            <p>Пожалуйста, вернитесь на предыдущую страницу и попробуйте отправить форму снова. Если проблема сохраняется, попробуйте очистить кэш и cookie вашего браузера.</p>
                        </div>
                    </div>
                </div>

                <div class="error-actions">
                    <a href="javascript:history.back()" class="study-btn study-btn-primary">
                                                <i class="fas fa-arrow-left"></i>
                        Вернуться назад
                    </a>
                    <a href="{% url 'profile' %}" class="study-btn study-btn-outline">
                        <i class="fas fa-home"></i>
                        Вернуться в кабинет
                    </a>
                    {% if not user.is_authenticated %}
                    <a href="{% url 'login' %}" class="study-btn study-btn-outline">
                        <i class="fas fa-sign-in-alt"></i>
                        Войти в систему
                    </a>
                    {% endif %}
                </div>

                {# Техническая информация для суперпользователей/администраторов #}
                {% if user.is_superuser or (user.is_authenticated and hasattr(user, 'role') and user.role.role_name == 'администратор') %}
                <div class="tech-info">
                    <h4>Техническая информация:</h4>
                    <p><strong>Путь:</strong> {{ request.path }}</p>
                    <p><strong>Метод:</strong> {{ request.method }}</p>
                    <p><strong>Пользователь:</strong> {{ user.username }}</p>
                    {% if hasattr(user, 'role') %}<p><strong>Роль:</strong> {{ user.role.role_name }}</p>{% endif %}
                    {% if csrf_reason %}
                        <p><strong>Причина CSRF:</strong> {{ csrf_reason }}</p> {# Отображаем причину, переданную из view #}
                    {% endif %}
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</section>

{% endblock %}

